# ============================================================================
# Assistant Agent - Full Configuration Reference
# ============================================================================
# This file documents ALL available configuration options.
# Copy sections you need to application.yml and customize them.
# ============================================================================

spring:
  application:
    name: assistant-agent-app

server:
  port: 8080

# ============================================================================
# DashScope Configuration (Required)
# ============================================================================
spring.ai.dashscope:
  api-key: ${DASHSCOPE_API_KEY}
  chat:
    options:
      model: qwen-max          # Options: qwen-max, qwen-plus, qwen-turbo
      # temperature: 0.7
      # top-p: 0.8

# ============================================================================
# Experience Module
# Default: enabled with in-memory storage
# ============================================================================
spring.ai.alibaba.codeact.extension.experience:
  enabled: true                       # Master switch
  code-experience-enabled: true       # Code generation experiences
  react-experience-enabled: true      # ReAct pattern experiences
  common-experience-enabled: true     # Common sense experiences

  # FastIntent - Quick response without full agent execution
  fast-intent-enabled: false          # Default: disabled
  fast-intent-react-enabled: true
  fast-intent-code-enabled: true
  fast-intent-allowed-tools: []       # Empty = no restriction; if set, include capability tools like submit_office_work_report

  # Query limits
  max-items-per-query: 5
  max-content-length: 2000

  # Storage: In-memory (default)
  in-memory:
    enabled: true
    max-total-experiences: 1000
    ttl-seconds: -1                   # -1 = never expire

  # Storage: Store-based (optional, for persistence)
  store:
    enabled: false
    namespace-prefix: experience

  logging:
    enabled: true

# ============================================================================
# Learning Module
# Default: enabled with after-agent learning
# ============================================================================
spring.ai.alibaba.codeact.extension.learning:
  enabled: true                       # Master switch

  online:
    enabled: true
    after-agent:                      # Learn after agent execution
      enabled: true
      learning-types:
        - experience
    after-model:                      # Learn after each model call
      enabled: false
    tool-interceptor:                 # Learn from tool executions
      enabled: false
      included-tools: []

  offline:
    enabled: false
    tasks: []

  async:
    enabled: true
    core-pool-size: 2
    max-pool-size: 4
    queue-capacity: 100

# ============================================================================
# Search Module
# Default: enabled with project and knowledge search
# ============================================================================
spring.ai.alibaba.codeact.extension.search:
  enabled: true
  project-search-enabled: true
  knowledge-search-enabled: true
  web-search-enabled: false           # Requires API key
  default-top-k: 10
  search-timeout-ms: 5000

# ============================================================================
# Reply Module
# Default: enabled with basic send_message tool
# ============================================================================
spring.ai.alibaba.codeact.extension.reply:
  enabled: true
  allow-config-override: true
  tools:
    - toolName: send_message
      channelCode: DEFAULT
      description: Send a message to the user
      reactEnabled: true
      codeActEnabled: true
      parameters:
        - name: text
          type: STRING
          required: true
          description: The message text

# ============================================================================
# Evaluation Module
# Default: enabled with input routing
# ============================================================================
spring.ai.alibaba.codeact.extension.evaluation:
  enabled: true
  async: false
  timeout-ms: 5000

  input-routing:
    enabled: true
    suite-id: react-phase-suite
  model-output:
    enabled: false
    suite-id: model_output_quality_suite
  code-generation-input:
    enabled: false
    suite-id: codeact-phase-suite
  code-execution:
    enabled: false
    suite-id: code_execution_suite
  session-summary:
    enabled: false
    suite-id: session_summary_suite

# ============================================================================
# Trigger Module
# Default: enabled
# ============================================================================
spring.ai.alibaba.codeact.extension.trigger:
  enabled: true
  scheduler:
    pool-size: 2
  execution:
    timeout-seconds: 300

# ============================================================================
# Capability Registration (Optional)
# Configuration-driven business capability tools (no hardcoded endpoint logic)
# ============================================================================
assistant:
  agent:
    capability:
      # Tenant-scoped provider registration.
      # Integrators implement provider protocol and register per tenant.
      tenant-providers:
        - tenant-id: default
          providers:
            - enabled: false
              provider-code: oa-capability-provider
              provider-version: v1
              base-url: https://oa-provider.example.com
              options-query-path: /api/capability/options/query
              entity-resolve-path: /api/capability/entity/resolve
              default-value-path: /api/capability/default/value
              submit-path: /api/capability/submit
              token-exchange-path: /api/oauth/token/exchange
              token-refresh-path: /api/oauth/token/refresh
              connect-timeout-ms: 5000
              read-timeout-ms: 10000
              headers:
                X-Provider-Client: assistant-agent
              auth:
                token-header-name: Authorization
                token-prefix: "Bearer "
                client-id: assistant-agent
                client-secret: ${OA_PROVIDER_CLIENT_SECRET:}
                refresh-token-encryption-key: ${CAPABILITY_REFRESH_TOKEN_KEY:assistant-agent-refresh-token-key}
                refresh-ahead-seconds: 60

      registrations:
        - enabled: false
          tool-name: submit_office_work_report
          provider-code: oa-capability-provider
          submit-action: submit_work_report
          description: Submit OA daily work report
          target-class-name: office_work_tools
          target-class-description: OA work report capability tools
          operation-intent-keywords:
            - 发起工作汇报
            - OA系统工作汇报
            - 工作汇报
          operation-intent-patterns:
            - ".*(发起|提交).*(工作汇报|日报|周报).*"
          slot-filling-enabled: true
          confirmation-required: true
          confirmation-arg-name: confirmed
          # Optional: direct endpoint fallback when provider-code is not configured.
          endpoint-url: http://office.test/oa/work/add
          method: POST
          content-type: application/x-www-form-urlencoded; charset=UTF-8
          connect-timeout-ms: 5000
          read-timeout-ms: 10000
          headers:
            Accept: "*/*"
            X-Requested-With: XMLHttpRequest
            Origin: http://office.test
            Referer: http://office.test/oa/work/add?types=1
          header-args:
            Cookie: cookie
          form-field-names:
            - types
            - start_date
            - end_date
            - to_unames
            - to_uids
            - approver_user_id
            - check_copy_uids
            - works
            - plans
            - send
            - remark
            - file
            - file_ids
            - id
          default-form-data:
            file: ""
            file_ids: ""
            id: "0"
          fields:
            - name: types
              type: string
              required: true
              description: 汇报类型（1=日报, 2=周报, 3=月报）
              input-mode: SELECT_SINGLE
              ask-mode: SINGLE
              infer-mode: LLM
              infer-prompt: 支持用户输入日报/周报/月报或1/2/3
              options:
                - label: 日报
                  value: "1"
                  description: 按天汇报
                - label: 周报
                  value: "2"
                  description: 按周汇报
                - label: 月报
                  value: "3"
                  description: 按月汇报
            - name: start_date
              type: string
              required: true
              description: 开始日期（可按类型自动带出）
              ask-mode: AUTO
              default-value-action: resolve_report_start_date
              depends-on:
                - types
            - name: end_date
              type: string
              required: true
              description: 结束日期（可按类型自动带出）
              ask-mode: AUTO
              default-value-action: resolve_report_end_date
              depends-on:
                - types
            - name: report_department_id
              type: string
              required: false
              description: 报告对象所属部门
              input-mode: SELECT_SINGLE
              option-query-action: query_departments
            - name: to_unames
              type: string
              required: true
              description: 汇报对象姓名（可多选）
              input-mode: SELECT_MULTI
              ask-mode: SINGLE
              infer-mode: LLM
              infer-prompt: 支持多个姓名，用逗号、顿号或空格分隔
              option-query-action: query_department_users
              entity-resolve-action: resolve_user
              depends-on:
                - report_department_id
            - name: to_uids
              type: string
              required: true
              description: 汇报对象ID（系统自动映射）
              input-mode: SELECT_MULTI
              option-query-action: query_department_users
              depends-on:
                - report_department_id
            - name: approver_department_id
              type: string
              required: false
              description: 审批人所属部门（可选）
              input-mode: SELECT_SINGLE
              option-query-action: query_departments
            - name: approver_user_id
              type: string
              required: true
              description: 审批人（单选，默认当前用户上级）
              input-mode: SELECT_SINGLE
              ask-mode: SINGLE
              infer-mode: LLM
              option-query-action: query_department_users
              default-value-action: query_default_approver
              depends-on:
                - approver_department_id
            - name: check_copy_uids
              type: string
              required: false
              description: 抄送人（可选）
              input-mode: SELECT_MULTI
              infer-mode: LLM
              option-query-action: query_all_users
            - name: works
              type: string
              required: true
              ask-mode: BATCH
              infer-mode: LLM
              description: 本期工作内容
            - name: plans
              type: string
              required: false
              infer-mode: LLM
              description: 下期工作计划（可选）
            - name: send
              type: string
              required: true
              description: 发送方式（0=仅保存, 1=立即发送）
              input-mode: SELECT_SINGLE
              ask-mode: SINGLE
              infer-mode: LLM
              infer-prompt: 支持用户输入仅保存/保存/不发送/立即发送/发送
              options:
                - label: 仅保存
                  value: "0"
                - label: 立即发送
                  value: "1"
            - name: remark
              type: string
              required: false
              description: Additional remark
            - name: cookie
              type: string
              required: true
              description: 认证 Cookie
        - enabled: false
          tool-name: submit_leave_application
          provider-code: oa-capability-provider
          submit-action: submit_leave_application
          description: Submit OA leave application
          target-class-name: office_leave_tools
          target-class-description: OA leave capability tools
          operation-intent-keywords:
            - 请假
            - 休假
            - 年假
            - 病假
            - 事假
            - 调休
          operation-intent-patterns:
            - ".*(请假|休假|年假|病假|事假|调休).*"
            - ".*(申请|提交).*(请假|休假).*"
          slot-filling-enabled: true
          confirmation-required: true
          confirmation-arg-name: confirmed
          endpoint-url: http://office.test/home/leaves/add
          method: POST
          content-type: application/x-www-form-urlencoded; charset=UTF-8
          connect-timeout-ms: 5000
          read-timeout-ms: 10000
          headers:
            Accept: "*/*"
            X-Requested-With: XMLHttpRequest
            Origin: http://office.test
            Referer: http://office.test/home/leaves/add?types=1
          header-args:
            Cookie: cookie
          form-field-names:
            - types
            - start_date
            - end_date
            - duration
            - reason
            - check_flow_id
            - check_uids
            - check_copy_uids
            - file_ids
            - id
          default-form-data:
            file_ids: ""
            id: "0"
          fields:
            - name: types
              type: string
              required: true
              description: 请假类型（事假/年假/病假/调休等）
              input-mode: SELECT_SINGLE
              option-query-action: query_leave_types
            - name: start_date
              type: string
              required: true
              description: 请假开始日期（yyyy-MM-dd）
            - name: end_date
              type: string
              required: true
              description: 请假结束日期（yyyy-MM-dd）
            - name: duration
              type: string
              required: false
              description: 请假时长（可选）
            - name: reason
              type: string
              required: true
              description: 请假原因
            - name: check_flow_id
              type: string
              required: false
              description: 审批流程（可自动带出）
              input-mode: SELECT_SINGLE
              option-query-action: query_leave_check_flow
            - name: check_uids
              type: string
              required: false
              description: 审批人（可多选）
              input-mode: SELECT_MULTI
              option-query-action: query_department_users
              default-value-action: query_default_approver
            - name: check_copy_uids
              type: string
              required: false
              description: 抄送人（可选）
              input-mode: SELECT_MULTI
              option-query-action: query_all_users
            - name: cookie
              type: string
              required: true
              description: 认证 Cookie
        - enabled: false
          tool-name: submit_meeting_room_booking
          provider-code: oa-capability-provider
          submit-action: submit_meeting_room_booking
          description: Submit OA meeting room booking
          target-class-name: office_meeting_tools
          target-class-description: OA meeting capability tools
          operation-intent-keywords:
            - 会议室预定
            - 会议室预订
            - 预约会议室
            - 订会议室
            - 开会
          operation-intent-patterns:
            - ".*(预定|预订|预约|订).*(会议室).*"
            - ".*(会议室).*(预定|预订|预约).*"
          slot-filling-enabled: true
          confirmation-required: true
          confirmation-arg-name: confirmed
          endpoint-url: http://office.test/adm/meeting/add
          method: POST
          content-type: application/x-www-form-urlencoded; charset=UTF-8
          connect-timeout-ms: 5000
          read-timeout-ms: 10000
          headers:
            Accept: "*/*"
            X-Requested-With: XMLHttpRequest
            Origin: http://office.test
            Referer: http://office.test/adm/meeting/add
          header-args:
            Cookie: cookie
          form-field-names:
            - room_id
            - title
            - start_date
            - end_date
            - num
            - requirement
            - join_uids
            - remark
            - check_flow_id
            - check_uids
            - id
          default-form-data:
            id: "0"
          fields:
            - name: room_id
              type: string
              required: true
              description: 会议室
              input-mode: SELECT_SINGLE
              option-query-action: query_meeting_rooms
            - name: title
              type: string
              required: true
              description: 会议主题
            - name: start_date
              type: string
              required: true
              description: 开始时间（yyyy-MM-dd HH:mm）
            - name: end_date
              type: string
              required: true
              description: 结束时间（yyyy-MM-dd HH:mm）
            - name: num
              type: string
              required: true
              description: 参会人数
            - name: requirement
              type: string
              required: true
              description: 会议需求（投影、电子屏等）
              input-mode: SELECT_MULTI
              option-query-action: query_meeting_requirements
            - name: join_uids
              type: string
              required: false
              description: 参会人员（可选）
              input-mode: SELECT_MULTI
              option-query-action: query_all_users
            - name: remark
              type: string
              required: false
              description: 会议说明（可选）
            - name: check_flow_id
              type: string
              required: false
              description: 审批流程（可自动带出）
              input-mode: SELECT_SINGLE
              option-query-action: query_meeting_check_flow
            - name: check_uids
              type: string
              required: false
              description: 审批人（可多选）
              input-mode: SELECT_MULTI
              option-query-action: query_department_users
              default-value-action: query_default_approver
            - name: cookie
              type: string
              required: true
              description: 认证 Cookie

# ============================================================================
# MCP Client (Optional)
# ============================================================================
spring.ai.mcp.client:
  enabled: false
  name: assistant-agent-mcp
  version: 1.0.0
  type: SYNC
  request-timeout: 30s
  toolcallback:
    enabled: true
  # stdio:
  #   servers-configuration: classpath:mcp-servers.json

# ============================================================================
# Logging
# ============================================================================
logging:
  file:
    name: ./logs/assistant-agent.log
  logback:
    rollingpolicy:
      max-file-size: 20MB
      max-history: 14
      total-size-cap: 2GB
  level:
    com.alibaba.assistant.agent: INFO
    # com.alibaba.assistant.agent: DEBUG
    # org.springframework.ai: DEBUG

