# ============================================================================
# Assistant Agent - Full Example Configuration
# ============================================================================
# This configuration demonstrates all available options with customizations.
# ============================================================================

spring:
  application:
    name: assistant-agent-full

server:
  port: 8081

# ============================================================================
# DashScope Configuration
# ============================================================================
spring.ai.dashscope:
  api-key: ${DASHSCOPE_API_KEY:sk-f173c68b3ced43f68e88f24caac90578}
  chat:
    options:
      model: qwen3-max

# ============================================================================
# Experience Module - with FastIntent enabled
# ============================================================================
spring.ai.alibaba.codeact.extension.experience:
  enabled: true
  fast-intent-enabled: true
  fast-intent-react-enabled: true
  fast-intent-code-enabled: true
  fast-intent-allowed-tools:
    - send_success_message
    - send_error_message
    - send_notification
    - write_code
    - write_condition_code
    - submit_office_work_report
    - submit_leave_application
    - submit_meeting_room_booking
  logging:
    enabled: true

# ============================================================================
# Learning Module - with after-agent learning
# ============================================================================
spring.ai.alibaba.codeact.extension.learning:
  enabled: true
  online:
    enabled: true
    after-agent:
      enabled: true
      learning-types:
        - experience

# ============================================================================
# Reply Module - with custom tools
# ============================================================================
spring.ai.alibaba.codeact.extension.reply:
  enabled: true
  tools:
    - toolName: send_success_message
      channelCode: IDE_TEXT
      description: Send a success message to the IDE console
      reactEnabled: true
      codeActEnabled: true
      parameters:
        - name: text
          type: STRING
          required: true
          description: The success message text
    - toolName: send_error_message
      channelCode: IDE_TEXT
      description: Send an error message to the IDE console
      reactEnabled: true
      codeActEnabled: true
      parameters:
        - name: text
          type: STRING
          required: true
          description: The error message text
    - toolName: send_notification
      channelCode: IDE_TEXT
      description: Send a notification message
      reactEnabled: true
      codeActEnabled: true
      parameters:
        - name: text
          type: STRING
          required: true
          description: The notification text

# ============================================================================
# Evaluation Module - with input routing
# ============================================================================
spring.ai.alibaba.codeact.extension.evaluation:
  enabled: true
  input-routing:
    enabled: true
    suite-id: react-phase-suite
  code-generation-input:
    enabled: true
    suite-id: codeact-phase-suite

# ============================================================================
# Prompt Contributor Module - 启用基于评估的 Prompt 贡献
# ============================================================================
spring.ai.alibaba.codeact.extension.prompt:
  enabled: true
  react:
    enabled: true
  codeact:
    enabled: true

# ============================================================================
# Capability Registration Example (disabled by default)
# ============================================================================
assistant:
  agent:
    capability:
      tenant-providers:
        - tenant-id: default
          providers:
            - enabled: false
              provider-code: oa-capability-provider
              provider-version: v1
              base-url: https://oa-provider.example.com
              options-query-path: /api/capability/options/query
              entity-resolve-path: /api/capability/entity/resolve
              default-value-path: /api/capability/default/value
              submit-path: /api/capability/submit
              token-exchange-path: /api/oauth/token/exchange
              token-refresh-path: /api/oauth/token/refresh
              auth:
                token-header-name: Authorization
                token-prefix: "Bearer "
                client-id: assistant-agent
                client-secret: ${OA_PROVIDER_CLIENT_SECRET:}
                refresh-token-encryption-key: ${CAPABILITY_REFRESH_TOKEN_KEY:assistant-agent-refresh-token-key}
                refresh-ahead-seconds: 60
      registrations:
        - enabled: true
          tool-name: submit_office_work_report
          # provider-code: oa-capability-provider
          # submit-action: submit_work_report
          description: Submit OA daily work report
          target-class-name: office_work_tools
          target-class-description: OA work report capability tools
          operation-intent-keywords:
            - 发起工作汇报
            - OA系统工作汇报
            - 工作汇报
            - 提交工作汇报
            - 写周报
            - 我要写周报
          operation-intent-patterns:
            - ".*(发起|提交).*(工作汇报|日报|周报).*"
            - ".*(写|创建).*(周报|日报|工作汇报).*"
          slot-filling-enabled: true
          confirmation-required: true
          confirmation-arg-name: confirmed
          endpoint-url: http://office.test/oa/work/add
          method: POST
          content-type: application/x-www-form-urlencoded; charset=UTF-8
          headers:
            X-Requested-With: XMLHttpRequest
            Origin: http://office.test
            Referer: http://office.test/oa/work/add?types=1
          header-args:
            Cookie: cookie
          form-field-names:
            - types
            - start_date
            - end_date
            - to_unames
            - to_uids
            - approver_user_id
            - check_copy_uids
            - works
            - plans
            - send
            - remark
            - file
            - file_ids
            - id
          default-form-data:
            file: ""
            file_ids: ""
            id: "0"
          fields:
            - name: types
              type: string
              required: true
              input-mode: SELECT_SINGLE
              ask-mode: SINGLE
              infer-mode: LLM
              infer-prompt: 支持用户输入日报/周报/月报或1/2/3
              description: 汇报类型
              options:
                - label: 日报
                  value: "1"
                  description: 按天汇报
                - label: 周报
                  value: "2"
                  description: 按周汇报
                - label: 月报
                  value: "3"
                  description: 按月汇报
            - name: start_date
              type: string
              required: true
              ask-mode: AUTO
              default-value-action: resolve_report_start_date
              depends-on:
                - types
              description: 汇报开始日期（根据类型自动带出，可修改）
            - name: end_date
              type: string
              required: true
              ask-mode: AUTO
              default-value-action: resolve_report_end_date
              depends-on:
                - types
              description: 汇报结束日期（根据类型自动带出，可修改）
            - name: report_department_id
              type: string
              required: false
              input-mode: SELECT_SINGLE
              option-query-action: query_departments
              description: 先选择部门，再选择人员
            - name: to_unames
              type: string
              required: true
              input-mode: SELECT_MULTI
              ask-mode: SINGLE
              infer-mode: LLM
              infer-prompt: 支持多个姓名，用逗号、顿号或空格分隔
              option-query-action: query_department_users
              entity-resolve-action: resolve_user
              depends-on:
                - report_department_id
              description: 汇报对象姓名（可多选）
            - name: to_uids
              type: string
              required: true
              input-mode: SELECT_MULTI
              option-query-action: query_department_users
              depends-on:
                - report_department_id
              description: 汇报对象ID（系统自动映射）
            - name: approver_department_id
              type: string
              required: false
              input-mode: SELECT_SINGLE
              option-query-action: query_departments
            - name: approver_user_id
              type: string
              required: true
              input-mode: SELECT_SINGLE
              ask-mode: SINGLE
              infer-mode: LLM
              option-query-action: query_department_users
              default-value-action: query_default_approver
              depends-on:
                - approver_department_id
              description: 审批人（单选）
            - name: check_copy_uids
              type: string
              required: false
              input-mode: SELECT_MULTI
              infer-mode: LLM
              option-query-action: query_all_users
              description: 抄送人（可选）
            - name: works
              type: string
              required: true
              ask-mode: BATCH
              infer-mode: LLM
              description: 本期工作内容
            - name: plans
              type: string
              required: false
              infer-mode: LLM
              description: 下期工作计划（可选）
            - name: send
              type: string
              required: true
              input-mode: SELECT_SINGLE
              ask-mode: SINGLE
              infer-mode: LLM
              infer-prompt: 支持用户输入仅保存/保存/不发送/立即发送/发送
              description: 发送方式
              options:
                - label: 仅保存
                  value: "0"
                - label: 立即发送
                  value: "1"
            - name: remark
              type: string
              required: false
            - name: cookie
              type: string
              required: true
        - enabled: true
          tool-name: submit_leave_application
          # provider-code: oa-capability-provider
          # submit-action: submit_leave_application
          description: Submit OA leave application
          target-class-name: office_leave_tools
          target-class-description: OA leave capability tools
          operation-intent-keywords:
            - 请假
            - 休假
            - 年假
            - 病假
            - 事假
            - 调休
            - 申请请假
          operation-intent-patterns:
            - ".*(请假|休假|年假|病假|事假|调休).*"
            - ".*(申请|提交).*(请假|休假).*"
          slot-filling-enabled: true
          confirmation-required: true
          confirmation-arg-name: confirmed
          endpoint-url: http://office.test/home/leaves/add
          method: POST
          content-type: application/x-www-form-urlencoded; charset=UTF-8
          headers:
            X-Requested-With: XMLHttpRequest
            Origin: http://office.test
            Referer: http://office.test/home/leaves/add?types=1
          header-args:
            Cookie: cookie
          form-field-names:
            - types
            - start_date
            - end_date
            - duration
            - reason
            - check_flow_id
            - check_uids
            - check_copy_uids
            - file_ids
            - id
          default-form-data:
            file_ids: ""
            id: "0"
          fields:
            - name: types
              type: string
              required: true
              input-mode: SELECT_SINGLE
              option-query-action: query_leave_types
              description: 请假类型（事假/年假/病假/调休等）
            - name: start_date
              type: string
              required: true
              description: 请假开始日期（yyyy-MM-dd）
            - name: end_date
              type: string
              required: true
              description: 请假结束日期（yyyy-MM-dd）
            - name: duration
              type: string
              required: false
              description: 请假天数（可选）
            - name: reason
              type: string
              required: true
              description: 请假原因
            - name: check_flow_id
              type: string
              required: false
              input-mode: SELECT_SINGLE
              option-query-action: query_leave_check_flow
              description: 审批流程（可自动带出）
            - name: check_uids
              type: string
              required: false
              input-mode: SELECT_MULTI
              option-query-action: query_department_users
              default-value-action: query_default_approver
              description: 审批人（可多选）
            - name: check_copy_uids
              type: string
              required: false
              input-mode: SELECT_MULTI
              option-query-action: query_all_users
              description: 抄送人（可选）
            - name: cookie
              type: string
              required: true
              description: 认证 Cookie
        - enabled: true
          tool-name: submit_meeting_room_booking
          # provider-code: oa-capability-provider
          # submit-action: submit_meeting_room_booking
          description: Submit OA meeting room booking
          target-class-name: office_meeting_tools
          target-class-description: OA meeting capability tools
          operation-intent-keywords:
            - 会议室预定
            - 会议室预订
            - 预约会议室
            - 订会议室
            - 开会
          operation-intent-patterns:
            - ".*(预定|预订|预约|订).*(会议室).*"
            - ".*(会议室).*(预定|预订|预约).*"
          slot-filling-enabled: true
          confirmation-required: true
          confirmation-arg-name: confirmed
          endpoint-url: http://office.test/adm/meeting/add
          method: POST
          content-type: application/x-www-form-urlencoded; charset=UTF-8
          headers:
            X-Requested-With: XMLHttpRequest
            Origin: http://office.test
            Referer: http://office.test/adm/meeting/add
          header-args:
            Cookie: cookie
          form-field-names:
            - room_id
            - title
            - start_date
            - end_date
            - num
            - requirement
            - join_uids
            - remark
            - check_flow_id
            - check_uids
            - id
          default-form-data:
            id: "0"
          fields:
            - name: room_id
              type: string
              required: true
              input-mode: SELECT_SINGLE
              option-query-action: query_meeting_rooms
              description: 会议室
            - name: title
              type: string
              required: true
              description: 会议主题
            - name: start_date
              type: string
              required: true
              description: 开始时间（yyyy-MM-dd HH:mm）
            - name: end_date
              type: string
              required: true
              description: 结束时间（yyyy-MM-dd HH:mm）
            - name: num
              type: string
              required: true
              description: 参会人数
            - name: requirement
              type: string
              required: true
              input-mode: SELECT_MULTI
              option-query-action: query_meeting_requirements
              description: 会议需求（投影、电子屏等）
            - name: join_uids
              type: string
              required: false
              input-mode: SELECT_MULTI
              option-query-action: query_all_users
              description: 参会人员（可选）
            - name: remark
              type: string
              required: false
              description: 会议说明（可选）
            - name: check_flow_id
              type: string
              required: false
              input-mode: SELECT_SINGLE
              option-query-action: query_meeting_check_flow
              description: 审批流程（可自动带出）
            - name: check_uids
              type: string
              required: false
              input-mode: SELECT_MULTI
              option-query-action: query_department_users
              default-value-action: query_default_approver
              description: 审批人（可多选）
            - name: cookie
              type: string
              required: true
              description: 认证 Cookie

# ============================================================================
# Logging - Debug level for development
# ============================================================================
logging:
  file:
    name: ./logs/assistant-agent.log
  logback:
    rollingpolicy:
      max-file-size: 20MB
      max-history: 14
      total-size-cap: 2GB
  level:
    com.alibaba.assistant.agent: DEBUG
