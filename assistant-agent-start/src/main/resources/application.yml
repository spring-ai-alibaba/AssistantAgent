# ============================================================================
# Assistant Agent - Full Example Configuration
# ============================================================================
# This configuration demonstrates all available options with customizations.
# ============================================================================

spring:
  application:
    name: assistant-agent-full
  # Persistent Datasource Provider Configuration (from line 173)
  assistant-agent:
    data:
      persistent-datasource:
        enabled: false  # Disabled by default, enable to use DataAgent database
        cache:
          enabled: true
          ttl-minutes: 5
          cleanup-interval-seconds: 60
        connection:
          url: jdbc:mysql://127.0.0.1:3306/saa_data_agent?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
          username: root
          password: StrongRootPwd
          pool:
            maximum-pool-size: 10
            minimum-idle: 2
            connection-timeout: 30000
      # NL2SQL Configuration
      nl2sql:
        enabled: false                          # Disabled by default, enable to use NL2SQL
        schema-filter-threshold: 10             # Filter schema when >= 10 tables
        llm:
          model: qwen-max                       # LLM model for SQL generation
          temperature: 0.1                      # Low temperature for deterministic output
          max-tokens: 2000                      # Maximum response tokens
        cache:
          enabled: true                         # Enable result caching
          ttl-minutes: 30                       # Cache time-to-live
          max-size: 1000                        # Maximum cache entries

server:
  port: 8080

# ============================================================================
# Authentication & JWT Configuration
# ============================================================================
auth:
  jwt:
    secret: ${JWT_SECRET:assistant-agent-secret-key-for-jwt-token-generation-must-be-long-enough-for-hs256-algorithm}
    expiration: ${JWT_EXPIRATION:86400000}  # 24 hours (in milliseconds)
    refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000}  # 7 days (in milliseconds)

# ============================================================================
# DashScope Configuration
# ============================================================================
spring.ai.dashscope:
  api-key: ${DASHSCOPE_API_KEY:sk-aa53c23886144d71a6128763863288e1}
  chat:
    options:
      model: qwen-max
  # Embedding model for vectorization
  embedding:
    options:
      model: text-embedding-v3

# ============================================================================
# Experience Module - FastIntent disabled to avoid conflict with Planning Intent
# ============================================================================
spring.ai.alibaba.codeact.extension.experience:
  enabled: false
  in-memory:
    enabled: false  # Disable InMemory, use Elasticsearch instead
  fast-intent-enabled: false
  fast-intent-react-enabled: false
  fast-intent-code-enabled: false
  fast-intent-allowed-tools:
    - send_success_message
    - send_error_message
    - send_notification
    - write_code
    - write_condition_code
  logging:
    enabled: true

# ============================================================================
# Learning Module - with after-agent learning
# ============================================================================
spring.ai.alibaba.codeact.extension.learning:
  enabled: false
  online:
    enabled: true
    after-agent:
      enabled: true
      learning-types:
        - experience

# ============================================================================
# Reply Module - with custom tools
# ============================================================================
spring.ai.alibaba.codeact.extension.reply:
  enabled: true
  tools:
    - toolName: send_success_message
      channelCode: IDE_TEXT
      description: Send a success message to the IDE console
      reactEnabled: true
      codeActEnabled: true
      parameters:
        - name: text
          type: STRING
          required: true
          description: The success message text
    - toolName: send_error_message
      channelCode: IDE_TEXT
      description: Send an error message to the IDE console
      reactEnabled: true
      codeActEnabled: true
      parameters:
        - name: text
          type: STRING
          required: true
          description: The error message text
    - toolName: send_notification
      channelCode: IDE_TEXT
      description: Send a notification message
      reactEnabled: true
      codeActEnabled: true
      parameters:
        - name: text
          type: STRING
          required: true
          description: The notification text

# ============================================================================
# Evaluation Module - with input routing
# ============================================================================
spring.ai.alibaba.codeact.extension.evaluation:
  enabled: true
  input-routing:
    enabled: true
    suite-id: input_routing_suite
  code-generation-input:
    enabled: true
    suite-id: code_generation_input_suite

# ============================================================================
# MySQL DataSource Configuration
# ============================================================================
spring.datasource:
  url: jdbc:mysql://localhost:3306/assistant_agent?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
  username: root
  password: ${MYSQL_PASSWORD:StrongRootPwd}
  driver-class-name: com.mysql.cj.jdbc.Driver

# ============================================================================
# MyBatis Plus Configuration
# ============================================================================
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      id-type: auto

# ============================================================================
# Elasticsearch Configuration
# ============================================================================
spring.elasticsearch:
  uris: http://localhost:9200
  username: elastic
  password: XWuH_rhjfz5ZD+Brrn0D

# Experience ES index name
spring.ai.alibaba.codeact.extension.experience.elasticsearch:
  index-name: experiences

# ============================================================================
# Planning Module - with Elasticsearch for SemanticActionProvider
# ============================================================================
spring.ai.alibaba.codeact.extension.planning:
  enabled: true
  elasticsearch:
    enabled: true
  # 评估集成配置 - 启用参数收集流程和 LLM 二次验证
  evaluation:
    enabled: true
    param-collection-enabled: true
    llm-verification-enabled: true  # 启用 LLM 二次验证（关键词+向量匹配后由 LLM 判断最终结果）
    llm-verification-max-candidates: 5  # LLM 验证的最大候选数量
    session-timeout-minutes: 60
    min-match-confidence: 0.5
  # 意图识别配置 - 调低阈值以便触发参数收集
  intent:
    enabled: true
    direct-execute-threshold: 0.95
    hint-threshold: 0.5
    keyword-filter-enabled: true

# ============================================================================
# Logging - Debug level for development
# ============================================================================
logging:
  level:
    com.alibaba.assistant.agent: DEBUG

